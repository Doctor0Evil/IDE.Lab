module tests.user_service {
    import std.test;
    import std.log;

    contract UserApi {
        fn get_user(id: string) -> string;
    }

    struct MockUserApi {
        expected_id: string;
        response: string;
    }

    impl UserApi for MockUserApi {
        fn get_user(id: string) -> string {
            test.assert_eq(id, self.expected_id, "unexpected user id");
            return self.response;
        }
    }

    fn fetch_username(api: UserApi, id: string) -> string {
        let raw = api.get_user(id);
        return raw;
    }

    @test
    fn test_fetch_username_uses_mock() {
        let api = MockUserApi {
            expected_id: "user-123",
            response: "mock-user-name",
        };

        let name = fetch_username(api, "user-123");
        test.assert_eq(name, "mock-user-name", "username mismatch");
        log.info("tests.user_service", "mocked test passed");
    }
}
