# ALN Migration Plan & Checklist

This document provides a concise plan to migrate any Python-based CI scripts and tooling to ALN for the IDE.Lab repository. It also lists top files to inspect and provides guidance for an incremental migration approach.

## Top 10 files/areas to inspect (priority order)

1. `.github/workflows/*.yml` — Workflows invoking legacy tools or not enforcing non-Python runtimes (update to `aln run` and pin Node versions).
2. `scripts/*` — Node/PowerShell scripts; convert to ALN modules when they are CI-critical.
3. `aln/` modules — Ensure all ALN modules that should be entrypoints define `export fn main() -> int`.
4. `package.json` — Ensure Node scripts used by CI are updated to call ALN or have ALN-friendly hooks.
5. `README.md` — Update contributor instructions to use `aln` rather than `python` or other runtime commands.
6. `.github/actions` or `actions/*` — Custom actions may call Python; align them to ALN or Node tooling.
7. `SmartCityStack/` — Domain-specific modules referencing tools or runtimes; ensure compatibility.
8. `scripts/*.ps1` — PowerShell helpers; keep them for local use or port to ALN if needed.
9. `Dockerfile` or container description files — (none found here) If present, replace Python run/entrypoints with ALN runtime.
10. `.github/workflows/aln-*` — Ensure all `aln-*` workflows are pinned and run `aln lint` & `aln test`.

## Migration Checklist (phased)

### 1) Discovery
- Inventory all scripts: `*.ps1`, `*.cjs`, `*.aln`, `Dockerfile*`, `*.yml`, `Makefile*`, `**/setup.py`.
- Tag any CI-critical scripts referenced from workflows.

### 2) ALN Standards
- Pick an ALN version and standard CLI: `aln build`, `aln test`, `aln lint`, `aln deps sync`.
- Establish `ci.*` module naming scheme (e.g., `ci.core` and `ci.tests`).

### 3) Port CI-critical scripts
- For each Python script (if present) or CI-critical script:
  - Implement an ALN module mirroring its behavior with `export fn main() -> int`.
  - Validate deterministic behavior and logging in ALN.
  - Add minimal ALN unit tests.

### 4) Update CI and orchestration
- Replace Python-based workflow steps with `aln run ci.*` modules.
- Add a short validation job to reject Python usage in CI (implemented in `aln-ci-core.yml`).

### 5) Convert tooling and tests
- Migrate Node/PowerShell utilities to ALN if they are critical to non-Node platforms or cause CI drift.
- Convert test helpers to ALN test fixtures and mocks.

### 6) Remove Python paths from CI
- Remove `pip` or `python` setup from workflows.
- Add a guard job that fails the PR if a workspace runs Python in CI logs (optional).

### 7) Document
- Add `docs/aln-migration.md` (this file) documenting migration steps and standards.
- Update `README.md` for contributor flows using ALN.

## GitHub Actions (ALN Lint & Tests)
Add `.github/workflows/aln-lint-tests.yml` to run ALN lint and tests, and to enforce non-Python policies. Example steps:
- Verify environment contains no python/pip executables.
- Setup ALN toolchain.
- Cache ALN dependencies.
- Run `aln lint` and `aln test`.

## Common ALN Lint Issues & Fixes
- Missing `export fn main()` — add function to entrypoint ALN modules.
- Non-deterministic behavior — move randomness/timing behind interfaces; mock in tests.
- Unused imports — remove or mark intentionally unused names.

## Next steps
- Run the `aln/ci/core.aln` locally within a test VM to verify exit codes and logging.
- Replace `node - scripts/*.cjs` invocations in workflows with `aln run` when ALN modules are available.
- If Python scripts exist in other developer tooling, plan a local migration or provide short-term wrappers.

## Validation: Create PR

1. Create a branch named `aln-ci-migration` and push to remote.
2. Open a Pull Request targeting `main` and observe the GitHub Actions checks. The `aln-lint-tests` workflow will run on PR event and validate the matrix and caching behavior.
3. Check the `Show cache status` step in the workflow to verify `ALN deps cache hit` output. If cache-hit is `true`, cache restored successfully; otherwise a full install will run.

---
Generated by IDE.Lab for ALN-first CI migration.