# HashiCorp Vault Bridge - ALN
# Integrates sealed_secret_vault with HashiCorp Vault

types:
  - name: VaultConfig
    type: object
    schema:
      - name: address
        type: string
        required: true
      - name: namespace
        type: string
        required: false
      - name: auth_method
        type: string
        required: true
      - name: mount
        type: string
        required: false
      - name: policies
        type: array
        required: false
        minItems: 0

exports:
  - name: issue_short_lived_token
    params:
      - name: vault_config
        type: VaultConfig
      - name: ttl_seconds
        type: number
    returns: string
    impl: "runtime"
    description: "Returns an opaque token_handle that maps to a short-lived token; runtime must not expose the raw token"

  - name: inject_runtime_secret
    params:
      - name: token_handle
        type: string
      - name: secret_path
        type: string
      - name: secret_name
        type: string
    returns: object
    impl: "runtime"
    description: "Returns an opaque handle object used by runtime to access secret values; no plaintext returned to the caller"

  - name: revoke_secret
    params:
      - name: token_handle
        type: string
    returns: boolean
    impl: "runtime"
    description: "Revokes the token associated with token_handle and invalidates secret handles"

  - name: rotate_secret
    params:
      - name: vault_config
        type: VaultConfig
      - name: secret_path
        type: string
    returns: object
    impl: "runtime"
    description: "Initiates rotation for a secret and returns new handle metadata; rotation preserves 'no plaintext exposure'" 

# Security: note that bridge functions should never log plaintext secret material; return opaque handles instead
# End of bridge
